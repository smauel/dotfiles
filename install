#! /usr/bin/env bash

function update_brew {
  which -s brew
  if [[ $? != 0 ]] ; then
    echo 'installing brew...'
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  else
    echo 'updating brew...'
    brew update
  fi
}

function install_brews {
  update_brew

  echo 'installing taps, brews and casks...'
  brew bundle
}

function symlink_dotfiles {
  echo 'symlinking dotfiles...'
  for dotfile in $(find . -name ".*" -type f -not -name ".ssh-config"); do
    echo " - ${dotfile}"
    ln -sf "${PWD}/${dotfile}" "${HOME}/${dotfile}"
  done
}

function symlink_scripts {
  echo 'installing scripts...'
  for file in bin/*; do
    local script=${file##*/}
    echo " - ${script}"
    ln -sf "${PWD}/bin/${script}" "/usr/local/bin/${script}"
  done
}

case $1 in
    all)
    symlink_dotfiles
    symlink_scripts
    install_brews
    shift
    ;;
    dotfiles)
    symlink_dotfiles
    shift
    ;;
    scripts)
    symlink_scripts
    shift
    ;;
    brews)
    install_brews
    shift
    ;;
    *)
    echo "usage: $programname [option]"
    echo "  all        install dotfiles, scripts and all brews, taps and casks"
    echo "  dotfiles   install dotfiles into ${HOME}"
    echo "  scripts    install scripts into /usr/local/bin"
    echo "  brews      install brews"
    exit 1
    ;;
esac
